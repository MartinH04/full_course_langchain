# 4.3.4 重排链

标题：源码解析：'Map Re-rank' 类型在文档处理链中的应用

在大数据和自然语言处理领域，各种不同的处理链方式可以用来优化信息检索和生成答案。本文将解析 'Map Re-rank' 类型的处理链，并说明其如何通过改变输入的组织和输出的生成方式来提高文档搜索的质量。

#### 1. 整体流程

'Map Re-rank' 文档处理链对每个文档运行初始提示，这个提示不仅试图完成任务，还对其答案的确定程度给出评分。最后，得分最高的响应将被返回。

#### 2. 映射和评分阶段

在这个阶段，系统对每个文档运行初始提示。每个文档都会被独立地处理，处理的方式是，系统不仅试图完成任务，还对其答案的确定程度给出评分。这样，每个文档都会被转化为一个新的文档，这个新文档包含了原始文档的处理结果和评分。

对于每个文档，作为提示(Prompt)传递给 LLM 的内容是原始文档, 但是提示模板增加了评分规则。拿到LLM链的答案后，存储为一个新文档，与原文档形成映射关系。

#### 3. 重排阶段（Re-rank Stage）

在这个阶段，系统根据每个新文档的评分进行重排。具体来说，系统会选择得分最高的新文档，并将其作为最终的输出。

只有这个类型有自动重排的机制，因为只有这个类型，对原始文档进行处理的时候，添加了评分规则的提示。

#### 4. 最终实现效果

通过 'Map Re-rank' 文档处理链，系统可以对每个文档独立地进行处理和评分，然后选择得分最高的结果作为最终输出。这种处理方式可以提高文档搜索的质量，特别是在处理大量文档的情况下。

#### 5. 适用场景

'Map Re-rank' 类型的处理链方式主要适用于处理大量文档的情况，特别是当需要从多个可能的答案中选择最优答案时。通过对每个文档的处理结果进行评分和重排，这种处理方式可以在有限的资源下找到最优的答案。然而，这种处理方式可能会使用更多的计算资源，并且可能在处理某些复杂任务（如文档之间频繁地交叉引用，或者需要从许多文档中获取详细信息）时可能表现不佳。

总的来说，通过使用 'Map Re-rank' 文档处理链，系统可以有效地处理大量文档的情况，并从多个可能的答案中选择最优答案，从而提高文档搜索的质量。然而，这种处理方式可能需要更多的计算资源，并且可能在处理复杂任务时表现不佳。